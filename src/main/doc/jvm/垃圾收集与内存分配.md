---
title: 垃圾收集与内存分配
date: 2019-01-16
comments: true 
tags:
- JVM
categories:  
- Java虚拟机
---

## 垃圾收集
垃圾收集（`Garbage Collection`), 俗称 `GC`。在系统中哪些内存需要回收？什么时候回收？怎样回收呢？当垃圾收集成为系统达到性能最优的阻碍时，我们就需要针对垃圾收集进行必要的监控与处理。

## 对象是否存活？
`Java`堆中存放几乎所有对象实例，垃圾收集器在回收对象时需要判断对象是否存活。哪些方法能够判断对象可以被回收呢？   
1). 引用计数算法   
给对象添加一个引用计数器，每当引用一次计数器 + 1， 引用失效 - 1。   
优点：实现简单，判定效率高。   
缺点：无法判断对象之间相互引用的问题。   
2). 可达性分析算法   
基本思路是通过`GC Roots`的对象作为起始点，向下开始搜索，所走过的路径成为引用链（Reference Chain）,当一个对象到 `GC Roots` 没有任何引用链相连时，表示该对象不可用，即是可以被回收的对象。   
在 `Java` 语言中，可作为`GC Roots`的对象包括下面几种：   
虚拟机栈（栈帧中的本地变量表)中引用的对象。   
方法区中类静态属性引用的对象。   
方法区中常量引用的对象。   
本地方法栈中JNI引用的对象。   

## 对象引用
`Java`中对对象的引用分为强引用，软引用，弱引用，虚引用四种，四种引用的强度依次递减。
1).强引用指的是类似`Object object = new Object()` 这类引用，只要强引用存在，引用的对象永远不会被垃圾收集器回收。   
2).软引用描述的是有用但非必需的对象，对于软引用关联的对象，在系统将要发生内存溢出之前，系统将会把这些对象进行二次回收，如果这次回收还没有足够的内存，才会发生内存溢出异常。   
3).弱引用也是描述非必需的对象，但是它的强度比软引用更弱一些， 被弱引用关联的对象只能生存到一下次垃圾收集之前。当垃圾回收的时候，无论内存足够，被弱引用关联的对象都会被回收。   
4).虚引用是最弱的一种引用关系，若有若无。