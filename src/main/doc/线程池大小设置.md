---
title: 合理设置Java线程池大小
date: 2018-12-23
comments: true 
tags:
- 线程池
categories:  
- Java并发  
---


## 设置Java线程池大小

线程池大小设置取决于所部署的系统中包含的`CPU`， 内存。 必须分析计算环境，资源预算和任务的特性。

### CPU密集型   
尽量使用较小的线程池，一般`CPU`核心数+1。因为`CPU`密集型任务CPU的使用率很高，若开过多的线程，只能增加线程上下文的切换次数，带来额外的开销。   
任务特性分为`CPU`密集型， `IO`密集型，混合密集型。对于`CPU`密集型， 在拥有`N`个`CPU`的处理器系统中，线程设置为 n + 1。   

### IO密集型
可以使用较大的线程池，一般`CPU`核心数 * 2， `IO`密集型`CPU`使用率不高，可以让`CPU`等待`IO`的时候处理别的任务，充分利用`CPU`时间。   
对于`IO`密集型，线程设置为 最佳线程数目 = （（线程等待时间+线程CPU时间）/线程CPU时间 ）* CPU数目， 比如线程等待时间为 1s,
而线程`CPU`时间为0.5s，假设当前`CPU`核心数为4核，则当前线程池大小为12。

在实际项目中可以通过
```java
 int cpuNum = Runtime.getRuntime().availableProcessors();
```
获取`CPU` cpuNum数目。   
结论：线程等待时间所占比例越高，需要越多线程。线程`CPU`时间所占比例越高，需要越少线程。
